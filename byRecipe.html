<html>

	<head>
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">
	<link rel="stylesheet" href="byRecipe.css">
	<link rel="stylesheet" href="https://unpkg.com/aos@2.3.0/dist/aos.css">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	<script src="https://kit.fontawesome.com/4b51920527.js"></script>
	
			<title>Search By Recipe</title>

	</head>

	<body>


		<div id="filler" class="has-background-success" data-aos="fade-up"></div>

		<div id="navContain" data-aos="fade-up">

			<nav class="breadcrumb is-centered  has-bullet-separator is-success has-background-success" aria-label="breadcrumbs">

			  <ul>
			  	<!-- creating nav bar and active tags -->
			    <li><a class="has-text-white has-text-weight-semibold" href="index.html">Home</a></li>
			   <li class="is-active"><a href="#" aria-current="page">Recipe Search</a></li>
			    <li><a class="has-text-white has-text-weight-semibold"href="byIngredient.html">Fridge Search</a></li>
			   
			    <li><a class="has-text-white has-text-weight-semibold"href="ourdata.html">Our Data</a></li>
			    
			  </ul>

			</nav>	

		</div>

		<div id="recipeSearch" data-aos="fade-up"> 
		<!-- data-aos is the animation tag from my imported animation library-->
			

			<div class="has-background-success">

				<div id="Greentitle" data-aos="fade-up"><h1 class="is-size-1 has-text-white has-text-centered is-family-primary has-text-weight-bold">Recipe Search</h1> <!-- page title-->
				</div>

				<div class="has-background-success" id="bodyContain">

					<div class="fSearch-container">


						  <div class="Fwidget"><!--fwidget is the input card (left side) div of the page-->

						  		<div class="card">
									  
									  <header class="card-header">

									    <p class="card-header-title has-text-success">
									      Search By Keyword <!--card title-->
									      <i class="fas fa-search" id="icon"></i>
									    </p>
									    
									  </header>

									  <div class="card-content">

									    <div class="content">
									    	<!--card description-->
									    	Using this widget, you may enter any recipe name or keyword and our data will provide you with the most healthy recipe option based on our generated Nutrition Score.

									      	<div id="searchBar"> <!--using BULMA CSS tags to customize input/entry bar-->

									      		<div class="field">

												  <p class="control has-icons-left has-icons-right">
												    <input id="search" class="input input is-success" placeholder="Enter recipe keyword..."> <!--"is-success" is the green color used throughout webpage-->

												    <span class="icon is-small is-left">
												      <i class="fas fa-search"></i> <!--search icon-->
												    </span>

												    <span class="icon is-small is-right">
												      <i class="fas fa-leaf"></i>
												    </span>

												  </p>

												</div>

											</div>

											<div id="RecentHistory"><!--recent searches div-->
													
												<div id="recent">
													<div id="recentText">Recent Searches: </div>
													<div id="recentText">  ~xxxxxxxx<br></div>
												</div>
												
											</div>

									    </div>

									  </div>
									
								</div>

						  </div>

						  		


						  <div class="Fresults"><!--search results card/div; right side of the program-->
						  	
						  		<div class="card">

									  <header class="card-header">
										    <p class="card-header-title has-text-success">
										      Search Results<!--card title-->
										      <i class="fas fa-list-alt" id="icon"></i>
										    </p>
									  </header>

									  <div class="card-content">

									    <div class="content"><!--card caption-->
									      We've searched our database and this is what we found as your healthiest option. You will be able to view in-depth data and information necessary for preparing the meal.
									     

									      <div class="info1">
									      	
									      	<div class="recipeImg" id="image"></div><!--creating a filler image before user selects enter-->

		  									<div class="infoRight">

		  										<!--7 empty text divs that display fetched data for associated recipe-->

		  										<h3 class="has-text-success" id="recipeName">Recipe Name</h3>

		  										<h5 class="has-text-success is-size-6 has-text-weight-bold" id="Nscore">Nutrition Score:</h5>
		  										
		  										<h5 class="has-text-success is-size-6 has-text-weight-light" id="time">Preparation Time</h5>

		  										<h5 class="has-text-success is-size-6 has-text-weight-light" id="difficulty">Difficulty</h5>

		  										<h5 class="has-text-success is-size-6 has-text-weight-light" id="calories">Calories</h5>

		  										<h5 class="has-text-success is-size-6 has-text-weight-light is-capitalized" id="diets">Diets</h5>

		  										<h5 class="has-text-success is-size-6 has-text-weight-light" id="cuisine">Cuisine</h5>
		  										

		  									</div>

									      </div>

									    </div>

									  </div>

									  <footer class="card-footer">

									  	<!--creating footer buttons for the results card that allow you to visit the recipe's instructions page and view more modal/popup using on click event--> 
									  		
										    <a id="link" href="" class="card-footer-item has-text-success">View Recipe Steps <i class="fas fa-link" id="icon"></i></a>

										    <a href="#" class="card-footer-item"></a>

										    <a class="card-footer-item has-text-success modal-button" data-target = "#modal">View More<i id="icon" class="fas fa-plus"></i></a>
										    <!--data-target allows you to see popup/modal onclick-->

			 						 </footer>
									  
								</div>

						  </div> 
					</div>

				</div>


			</div>

		</div>

 		<div id="popcon"><!--popup/modal container taken from bulma io-->

			<section class = "section" id="popup">

         		<div class = "container">

         	

            		<div id = "modal" class = "modal">
               			<div class = "modal-background"></div>

               			<div class = "modal-content">
                  
                     		<div class="modal-card">

							    <header class="modal-card-head">
							      <p class="modal-card-title has-text-weight-bold has-text-success" id="poptitle"></p>
							    </header>

    							<section class="modal-card-body">
    								 <!--creating empty divs in modal for api fetched data to be inputted-->
    								<p class="has-text-weight-bold" id="popUpContent">Summary<br><br></p><!--summary div-->
    								<div id="popUpContent">
    									<div id="summary"></div>
    							    </div><br><br>

    								<p class="has-text-weight-bold" id="popUpContent">Nutritional Info (13 Most Prevalent Ingredients)<br><br></p>

    								<div id="nutrientInfo" class="is-success"></div><!--nutrient progress bar containers-->

    								<br><br> <p class="has-text-weight-bold" id="popUpContent">Ingredient Info<br><br></p>

    								<div id="popUpContent">

    									<div class="field is-grouped is-grouped-multiline" id="ingredientInfo">
										</div><!--ingredient List container-->

    								</div>
    								<br><br><p class="has-text-weight-bold" id="popUpContent">Other Options for Your Searched Keyword<br><br></p><!-- div to display other recipes that were searched with the same ingredient query-->
    								<div id="NutritionScoreTitle">Recipe (Nutrition Score)<br><br></div><!--search results subtitle-->
    								<div id="otherRecipe" class="is-capitalized"></div>
    
    							</section>
  							</div>
               
               			</div>
               			<!--close button for popup/modal-->
               			<button class = "modal-close is-large" aria-label = "close"></button>
            		</div>
        		</div>
      		</section>

      	</div>
		<!--divs essential for testing script program. they print important data that needs to be set as a variable-->
	     <div id="testdivs">

		     <div id="output"></div>
		     <div id="name"></div>
		     <div id="working"></div>
			 <div id="sample"></div>

		 </div>

  		<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script><!--referencing jquery-->
  		<script src="https://unpkg.com/aos@2.3.0/dist/aos.js"></script><!--referencing data-aos library-->
  		
	</body>

	<script>
		//binding enter button to search function to enable it to be executed without an actual button
		enterkey = document.getElementById("search")   
		enterkey.addEventListener('keyup', function(event) {
		if (event.keyCode === 13) { //enter key = key 13
			goSearch(); //search function name (event driven programming)
		}
		});


		//smooth scroll function used for animations to ensure it is effectively aesthetic		
		$(function() 

		{

		  $('a[href*=#]').on('click', function(e) {
		    e.preventDefault();
		    $('html, body').animate({ scrollTop: $($(this).attr('href')).offset().top}, 500, 'linear');
		  });

		});


		AOS.init({
		  duration: 1600, //duration of each fade in/out animation
		})



		//modal buttons -- close and open buttons taken from BULMA IO
		 $(".modal-button").click(function() {
		    var target = $(this).data("target");
		    $("html").addClass("is-clipped");
		    $(target).addClass("is-active");
		 });
		         
		$(".modal-close").click(function() {
		    $("html").removeClass("is-clipped");
		    $(this).parent().removeClass("is-active");
		});


		//recent search array. data is pushed as user searches for recipes
		recentList = []

		var result = document.getElementById("search").value //variable that reads user input in entry bar

		
		//async (promise based behavior) function to search for recipes with the selected ingredients
		async function fetchURL(url, callNumber) //parameters for each time the API is called since I called my API multiple times each time with a unique url

		//async allows my program to be ran non-concurrently each time -- enabling data to be fetched in a consistent order

		{

		    recipeList = []//setting empty array for ids of found recipes
		    scoreList = [] //setting empty array for nutrition score of each found recipe

		 
		   
		    await fetch(url) //requesting data using my api key -- await is used to ensure completion of previous task before executing the next
		        .then((res) => res.json()) // converting data to json
		        .then(async(output) => 
		        {
		            var data = output;
		         

		            if (callNumber == 1)//specifying call number parameter -- first call number finds all search results based on user input (recipe keyword)
		            {

			            data2 = data['searchResults'][0]['results'] //setting variable for all search results that are recipes -- the API enables you to view foods, ingredients, etc. I specified to see only recipes

			            if (data2.length == 0){ //error handling for invalid recipe input -- checks whether data is found (if there was no data found there would be an error)
			            	alert("Your Recipe Keyword does not exist in our dataset. Please try again using another input. E.g. Chicken Burrito, Pasta")
			            	return
			            }



			            recipeMaster = [] //empty array that will contain each found recipe's name and nutrition score

			            for (recipe in data2){ //for loop to identify all 10 recipes found from API with user inputted ingredients

			            	var recName = data2[recipe]["name"] //finds recipe name
			            	
			                var recipeIndex = data2.indexOf(data2[recipe])
			                //creates a variable for the index of each found recipe (usually there are 10 search results)
			                var meal = data2[recipe]["id"] //id is numerical code of each recipe
			            
			              
			                recipeList.push(meal) //adding the ids to a list of recipes

			                //subsequent fetch to find nutrition info of each recipe in search results. Goal is to create a nutrition score for each recipe
			                
			               
			                
			                await fetch("https://api.spoonacular.com/recipes/"+meal+"/nutritionWidget.json?apiKey=1e4ac0fc6eff4598a34767b5a6ffaa14")
			                //subsequent fetch gathers nutrition data of each recipe

			                .then((res) => res.json()) // converting data to json
			                .then(output => {

			                var data1 = output;

			                //setting variables for set of data of "good nutrients" (e.g. protein, vitamins, etc)
			         
			                var goodNutrients = data1['good']


			                // int variable that will altered in for loop (sum of nutrient quantities e.g. 10g protein)
			                sum=0

			                var numNutrients = goodNutrients.length   //number of good nutrients

			                for (nutrient=0; nutrient<goodNutrients.length; nutrient++){
			                    percentValue = goodNutrients[nutrient]["percentOfDailyNeeds"]
			                    sum = sum + percentValue;
			                    //adding the percent value of each nutrient to a nutrient sum
			            	}

				            var NutritionValue = sum/numNutrients//NUTRITION SCORE CALCULATION (averaging percent of daily value of each nutrient)

				            //dividing sum of all % values by number of nutrients

				            //sample calc: protein: 77% of daily value, vitamin a: 90% of daily value, vitamin b: 110% of daily value
				            //nutrition score = 77+90+110/3 (average)


				            var finalScore = Math.round(NutritionValue) //round to nearest integer for nutrition score
				            //console.log(finalScore);
				            scoreList.push(finalScore) //adding all nutrition scores to an array
				            var Recipeinfo = recName + " (" + finalScore + ")"
				            recipeMaster.push(Recipeinfo) //adding each recipe's nutrition score and name to an array
			            
			                
			                
			                 })
			            }
			            
			            document.getElementById("otherRecipe").innerHTML = recipeMaster.join(" <br> ")
			          
			            var best = Math.max(...scoreList) //finding the highest nutrition score of all search results
			      
			            var indexNum = scoreList.indexOf(best) //finding index num of best nutrition score in its list
			            var BestFood = recipeList[indexNum] // using index to identify the recipe with the best nutrition score. This is the recipe shown to the users on the results tab
			        
			            document.getElementById("output").innerHTML = BestFood
			            if (best>125){ //classifying how healthy the healthiest recipe is based on nutrition score
			            	document.getElementById("Nscore").innerHTML = "Nutrition Score: " + best +" (Extremely Healthy)";

			            }
			            else if (best>75){
			            	document.getElementById("Nscore").innerHTML = "Nutrition Score: " + best+" (Very Healthy)";
			            }
			            else if (best>35){
			            	document.getElementById("Nscore").innerHTML = "Nutrition Score: " + best+" (Moderately Healthy)";
			            }
			            else{
			            	document.getElementById("Nscore").innerHTML = "Nutrition Score: " + best+" (Not Healthy)";
			            }
			           


		            }

		            else if (callNumber == 2){


		            	//specifications for new call number (new API url). this callnumber finds recipe information of only the healthiest recipe ("BestFood") based off the previously calculated nutrition score



		            	var name = data['title']
		            
		                recentList.push(name) //adding found recipe to recent searches array

		                document.getElementById("search").value = "" //resetting input text

		                var allRecent = recentList.join(" <br> ")
		                document.getElementById("recentText").innerHTML = allRecent //printing recent search to search history div

		                //printing recipe name to div(s)
		                document.getElementById("recipeName").innerHTML = name;
		                document.getElementById("poptitle").innerHTML = name;
		                
		            	document.getElementById("time").innerHTML = "Preparation Time: " + data["readyInMinutes"] + " minutes" //printing recipe preparation time

		            	var steps = data["analyzedInstructions"][0]["steps"].length
		            	if (steps>15){//classifying a recipe as difficult if it needs 15 steps or more to complete
		            		document.getElementById("difficulty").innerHTML = "Difficulty: Experienced Chef (Hard)"
		            	}
		            	else if (steps>5){//classifying a recipe as intermediate if it needs 5 steps or more to complete
		            		document.getElementById("difficulty").innerHTML = "Difficulty: Intermediate Chef (Medium)"
		            	}
		            	else {//classifying a recipe as easy if it needs less than 5 steps to complete
		            		document.getElementById("difficulty").innerHTML = "Difficulty: Beginner Chef (Easy)"
		            	}


		                RecName = document.getElementById("name");
		                RecName.innerHTML = data["title"]

		                recipeLink = data["sourceUrl"]//identifying the link to the recipe's instructions website.
		                document.getElementById("link").href = recipeLink; //setting recipe link in the associated btn


		                document.getElementById("diets").innerHTML = "Diets: " + data["diets"].join(", ") //printing the recipe's diets to result div
		                document.getElementById("cuisine").innerHTML = "Cuisine: "+ data["cuisines"].join(", ")
		                //printing the recipe's cuisines to result div

		                if (data["cuisines"].length == 0){ //error checking: determining whether the recipe has an assigned cuisine. If it doesn't, print "none" to the results div
		                	document.getElementById("cuisine").innerHTML = "Cuisine: None"
		                }
		                var ImageURL = data['image'] //identifying the image src of the recipe's image
		     			
		     			//presenting the image of the recipe to the screen
		                document.getElementById("image").innerHTML = "<img id='foodimg' src="+ImageURL+">"
		                document.getElementById("image").style.backgroundColor= "white";
		                document.getElementById("image").style.height= "220px";
		                document.getElementById("image").style.paddingRight= "20px";

		                //printing recipe summary to UI
		                document.getElementById("summary").innerHTML = data["summary"]
		       


		            }

		            else if (callNumber==3){
		            	nutrientInfoList = []
		            	document.getElementById("calories").innerHTML = "Calories: " + data["calories"] //printing the calories of the recipe to the screen

		            	var goodNutrients = data['good'] 
		            	var pBarclass = "is-success is-large" //setting a variable for the CSS class of a progress bar I will place onto the popup for each nutrient

		            	
		            	for (nutrients=0;nutrients<13;nutrients++){
		            		//for loop that prints 13 progress bars to the screen on nutrient quantities
		            		var nutrientName = goodNutrients[nutrients]['title'] //identifying all "good" nutrients
		            		var amount = goodNutrients[nutrients]['amount']//identifying quantity of nutrient in a recipe


		            		var dailyValue = Math.round(goodNutrients[nutrients]['percentOfDailyNeeds'])//identifying percent of daily value of each nutrient


		            		var datastring = nutrientName+" ("+amount+")<br><div class='pContain'>Percent of Daily Value: "+dailyValue+"%<progress class='"+pBarclass+"' value='"+dailyValue+"' max ='100'>"+dailyValue+"</progress></div>" //variable used to print a progress bar for each nutrient using HTML syntax
		            		
		            		nutrientInfoList.push(datastring);	//adding each progress bar string to a list
		            		
		            	}

		            	document.getElementById("nutrientInfo").innerHTML = "The following data points are all statistics on the quantity of each good nutrient in the recipe as a percent of your required amount for that nutrient each day(Percent of Daily Value). In essense, the higher the value, the healthier the dish. <br><br>" + nutrientInfoList.join("<br>")  //printing each of the 13 progress bars to the screen 

		            }

		            else if (callNumber == 4){ //callnumber that identifies ingredients in a recipe
		            	

		            	ingredientList = []
		            	foodList = data["ingredients"] //variable for all ingredients in a recipe
		            	for (food=0;food<foodList.length;food++){ //for loop iterates through ingredients and prints each
		            		var ingredientName = foodList[food]["name"]; //identifying each ingredient name
		            		var amount = Math.round(foodList[food]["amount"]["metric"]["value"]) + " " + foodList[food]["amount"]["metric"]["unit"]; //identifying amount of each ingredient

		            		//string that follows HTML syntax to print a tag containing each ingredient
		            		var ingredientString = "<div class='tags has-addons px-1'><span class='tag'>"+amount+"</span><span class='tag is-success'>"+ingredientName+"</span></div>"
		            		ingredientList.push(ingredientString)
		            	}
		            	
		            	document.getElementById("ingredientInfo").innerHTML = ingredientList.join(" ")


		            	
		            }

		        })
		      

		}

		async function goSearch() //function that executes previous modular function using different parameters and API urls
		{
			result = document.getElementById("search").value;
			if (result == ""){ //error checking to see if the user has actually inputted a valid keyword
				alert("Please Enter a Valid Keyword");
				return;r
			}
		    url1 = "https://api.spoonacular.com/food/search?apiKey=1e4ac0fc6eff4598a34767b5a6ffaa14&query="+result;
		    await fetchURL(url1, 1); //first callnumber finds all recipes matched with the user's keyword


		    foodname = document.getElementById("output").innerHTML
		    //variable that identifies the healthiest recipe's id rhat was printed to the page. This is needed to be used in the next http request

		    url2 = "https://api.spoonacular.com/recipes/"+foodname+"/information?apiKey=1e4ac0fc6eff4598a34767b5a6ffaa14";
		    await fetchURL(url2, 2);//second call number fetches general information on the found "healthiest" recipe

		    RecName = document.getElementById("name");
		    
		    url3 = "https://api.spoonacular.com/recipes/"+foodname+"/nutritionWidget.json?apiKey=1e4ac0fc6eff4598a34767b5a6ffaa14";
		    await fetchURL(url3, 3) //third call number finds all nutritional information for the healthiest 
		    
		    url4 = "https://api.spoonacular.com/recipes/"+foodname+"/ingredientWidget.json?apiKey=1e4ac0fc6eff4598a34767b5a6ffaa14";
		    await fetchURL(url4, 4) //fourth call number fetches data on similar recipes 
		   

		}





	</script>


</html>
